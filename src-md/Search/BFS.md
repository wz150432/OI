# 深度优先搜索（DFS）基础概念

在OI（信息学奥林匹克）中，搜索是解决“枚举所有可能”类问题的核心算法，而**深度优先搜索（DFS，Depth-First Search）** 是最基础、最常用的搜索方式之一。掌握其基础概念，是后续灵活应用的前提。接下来从“定义”“核心思想”“关键要素”“常见问题”“应用场景”五个维度，拆解DFS的基础概念。


## 一、DFS的定义：什么是深度优先搜索？
DFS的本质是“**一条路走到黑，走不通就回头**”，可通过生活中“走迷宫”的场景通俗理解： 

假设你站在迷宫起点，面前有多个岔路（如3条：上、下、右）。你会先选其中一条路（比如“上”），沿着这条路一直往前走，直到走到死胡同（前方是墙，且没有未探索的其他岔路）；此时你会退回到上一个有未探索岔路的路口，换另一条未尝试的路（比如“下”），再次走到尽头；重复这个“探索→碰壁→回溯→换路”的过程，直到找到出口，或遍历完所有可能的路径。

从专业角度定义：DFS是一种从起始节点出发，**优先探索当前路径“深度”**（尽可能向路径的更远端延伸）的搜索策略；当当前路径无法继续延伸时，**回溯（Backtrack）** 到上一个决策节点，探索其他未尝试的分支路径，最终实现对所有可能路径的遍历。




## 二、DFS的核心思想：递归与回溯的协同
DFS的实现完全依赖“递归”和“回溯”两个关键技术，二者相辅相成，缺一不可：

### 1. 递归：实现“一条路走到黑”的逻辑
递归是指“函数自身调用自身”的编程技巧，在DFS中用于“持续向当前路径的深处探索”。 
比如在路径探索中，当你走到位置A，需要探索从A出发的下一个位置B时，可调用同一个DFS函数来处理位置B；处理B时，又能调用该函数探索B的下一个位置C——通过这种“自我调用”，实现“从起点一直走到路径尽头”的效果。 
简单来说，递归帮DFS完成“向前走”的动作，让探索能持续推进。

### 2. 回溯：实现“走不通就回头”的逻辑
回溯是指“撤销上一步的选择，回到之前的状态”，在DFS中用于“探索完一条死路后，恢复初始状态以探索其他路径”。 
比如探索路径时，你标记了“已访问的位置A”以避免重复走；当这条路径走到尽头（死路），你需要退回到上一个位置B时，必须“取消位置A的已访问标记”——否则后续探索其他路径时，位置A会被误判为“已访问”，导致漏探索。 
简单来说，回溯帮DFS清理“向前走”留下的痕迹，确保不同路径的探索互不干扰。

### 3. 递归与回溯的关系
递归是“向前探索”的动力，回溯是“回头换路”的保障：没有递归，DFS无法持续深入；没有回溯，DFS会因残留标记导致探索错误，二者共同构成DFS的核心逻辑。


## 三、DFS的关键要素：支撑搜索的基础组件
要实现DFS，需明确三个关键要素，它们是构成DFS的基础框架（仅理解概念即可）：

### 1. 访问标记：避免重复探索与死循环
- **作用**：记录“已探索过的节点/位置”，防止同一节点被反复探索（导致死循环）或漏探索（因误判已访问而跳过）。  
- **核心逻辑**：当探索到一个新节点时，标记为“已访问”；当回溯离开该节点时，取消“已访问”标记（回溯的关键动作）。  
- 通俗体现：走迷宫时用“粉笔标记走过的格子”，回头时擦掉标记。

### 2. 方向/分支遍历：覆盖所有可能路径

- **作用**：明确“当前节点可探索的所有分支方向”，确保不遗漏任何一条可能的路径。  

- **常见场景**：  
  
  - 网格类问题（如迷宫）：通常有4个方向（上、下、左、右），或8个方向（含斜向）；  
  - 图类问题：当前节点的所有“相邻节点”（通过边连接的节点）即为可探索分支；  
  - 组合类问题：当前位置可选择的“未选元素”即为可探索分支。  
  
- 核心逻辑：按固定顺序遍历所有方向/分支，每个分支对应一条独立的探索路径。

    

### 3. 递归函数结构：明确探索的步骤

DFS的递归函数需包含三个核心步骤（逻辑层面），确保探索有序且不混乱：  
- **步骤1：终止条件**：定义“什么时候停止探索”，比如“找到目标节点”“所有分支已探索完”“当前节点越界（如迷宫墙外）”，触发后会回溯到上一节点。  
- **步骤2：合法判断**：定义“当前分支/方向是否可探索”，通常需满足“未越界”（如网格内、图内）和“未访问”（通过访问标记判断）两个条件，过滤无效路径。  
- **步骤3：回溯清理**：探索完当前分支后，撤销当前节点的访问标记（或其他临时状态），恢复初始状态以探索下一个分支。



## 例题

[P1219](https://www.luogu.com.cn/problem/P1219)